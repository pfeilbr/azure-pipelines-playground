# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  - master
  
pool:
    vmImage: 'ubuntu-latest'
  
steps:
  - script: echo Hello, world!
    displayName: 'Run a one-line script'

  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.6'
      architecture: 'x64'

  - script: | 
      sudo pip3 install --upgrade pip
      pip3 install awscli --upgrade --user
      export PATH="/home/vsts/.local/bin:$PATH"
      echo $PATH
      aws --version
      which -a aws
      ls -alt /home/vsts/.local/bin/aws
      ls -alt /usr/local/bin/aws
      /home/vsts/.local/bin/aws --version
      /usr/local/bin/aws --version
    displayName: 'Install AWS CLI'
    env:
      AWS_ACCESS_KEY_ID: $(AWS_ACCESS_KEY_ID)
      AWS_SECRET_ACCESS_KEY: $(AWS_SECRET_ACCESS_KEY)

  - script: | 
      echo $AWS_ACCESS_KEY_ID
      export PATH="/home/vsts/.local/bin:$PATH"
      aws s3 ls
    displayName: 'list S3 buckets'
    env:
      AWS_ACCESS_KEY_ID: $(AWS_ACCESS_KEY_ID)
      AWS_SECRET_ACCESS_KEY: $(AWS_SECRET_ACCESS_KEY)    
  